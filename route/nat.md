# NAT到底是什么
（本文一切提到的IP地址均为示例，不代表现实世界里的情景）

## 32位的IPv4不够了
IPv4设计了32位的地址长度，理论上可以容纳4,294,967,296个设备。在设计之初，这个地址长度是很大的，整个IP网络的核心思路也是“每台设备都要有独一无二的IP”。但到了1992年，大家就发现，IP地址要不够用了。因为分配不均和网络设备快速增长的原因，IPv4的地址池快速枯竭，而且随着IP地址越用越多，路由表开始迅速膨胀。1994年的RFC1631规定了NAT, Natwork Address Translation, 作为“一个用以解决IP枯竭和路由表膨胀的短期方案”。但这时的人们犯了和当年的Grace Hopper一样的错误————任何短期的方案，都很可能变成长期固定的方案。等到了2004年，NAT就开始大面积普及了。

## IPv4的保留地址和私有网络
在标准制定之初，IPv4设计了一些保留地址块。
| 地址块 | 用途 |
| ----------- | ----------- |
| 0.0.0.0/8 | 本地网络 |
| 10.0.0.0/8 | 私有网络的内部通信 |
| 100.64.0.0/10 | 电信级NAT |
| 127.0.0.0/8 | 回环地址 |
| 169.254.0.0/16 | 链路本地地址 |
| 172.16.0.0/12 | 私有网络的内部通信 |
| 192.168.0.0/16 | 私有网络的内部通信 |
| 240.0.0.0/4 | 曾经的E类地址 |
NAT最常使用的四个地址块，就是10.0.0.0/8, 100.64.0.0/10, 172.16.0.0/12和192.168.0.0/16. 每个地址块的大小不一，其中最后一个更多是家庭用户使用，前面三个多见于企业环境。这些地址（包括其它一些保留地址）在公网是不会被路由的。到这里就会有一个问题，什么是“公网”，它和“私网”或者“内网”的区别是什么？

在目前的互联网生态下，你不妨简单地理解为，公网即大家可以自由访问的网络地址，私网则与之相反；但是私有网络的IP地址不一定只能使用保留地址。福特汽车持有整个19.0.0.0/8的地址块，它内部的办公环境就用这些地址。拥有一个全网独一无二的IP是主机可以被自由访问的既不充分也不必要条件，最多只能算“强相关”。即便我们现在知道福特的内部办公设备的地址就在19.0.0.0/8之内，也不代表从互联网上能自由访问福特的私有网络，因为在Internet和它之间还有一道防火墙，它阻止了对私有网络的访问。与之类似的奢侈企业还有苹果，整个17.0.0.0/8也是苹果独享的地址块。